#!/bin/bash

#Init variables
servnum=0
listfile="/etc/ssh-menu/server-list"

#Check server-list file length
filelength=$(($(wc -l < $listfile)+1))

#Check if there is command line argument
if [ $# -ne 0 ]
  then
    servnum=$1
    #Check if argument is out of the range
    if [[ $servnum -lt 1 || $servnum -gt $filelength ]]
      then
        echo "Wrong server number" && exit
      fi
  else
    #Interactive server choice mode
    #Chose server number
    while :;
    do
        #Clear screen
        clear
    
        #Offer options to choose
        echo "chose server you want to connect"
        echo ""
        cat --number $listfile | highlight -O xterm256 --syntax=bash
        echo ""
        echo ""
        echo "Enter server's number in the list:"
        read servnum
        #Check server number
        if ((servnum > 0 & servnum <= filelength)); then
            break
        fi
    done
fi

#Extract ssh command from list
sshcommand=$(head -n $servnum $listfile | tail -1)

#Clear screen
clear

#Execute command
eval "$sshcommand"
