#!/bin/bash

#Init variables
servnum=0
listfile="/etc/ssh-menu/server-list"

#Check server-list file length
filelength=$(($(wc -l < $listfile)+1))

#Check if there is command line argument
if [ $# -ne 0 ]
  then
    servnum=$1
    #Check if argument is out of the range
    if [[ $servnum -lt 1 || $servnum -gt $filelength ]]
      then
        echo "Wrong server number" && exit
      fi
    #Create ssh command from valid line
    sshcommand=$(head -n $servnum $listfile | tail -1)
  else
    #Interactive server choice mode

    #Read server list into array for menu
    mapfile -t servarray < $listfile

    #Chose server number

        #Clear screen
        clear
    
        #Offer options to choose
        echo "chose server you want to connect"
        echo ""
        COLUMNS=1
        select servchoice in "${servarray[@]}"
          do 
            sshcommand="$servchoice"
            break;
          done
fi

#Clear screen
clear

#Execute command
eval "$sshcommand"
